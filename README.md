# üöÅ Flight Control ‚Äî ROS 2 –ø–∞–∫–µ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è PX4 –¥—Ä–æ–Ω–∞–º–∏

[![ROS 2](https://img.shields.io/badge/ROS%202-Humble%20|%20Iron%20|%20Jazzy-blue)](https://docs.ros.org/)
[![PX4](https://img.shields.io/badge/PX4-Autopilot-orange)](https://px4.io/)
[![MAVROS](https://img.shields.io/badge/MAVROS-2.x-green)](https://github.com/mavlink/mavros)
[![Status](https://img.shields.io/badge/Status-In%20Development-red)](https://github.com/your-repo)

**Flight Control** ‚Äî —ç—Ç–æ –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π ROS 2 –ø–∞–∫–µ—Ç –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–Ω–æ–º–Ω—ã—Ö –º–∏—Å—Å–∏–π PX4 –¥—Ä–æ–Ω–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º MAVROS. –ü–∞–∫–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—É—é –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é –Ω–∞–¥ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º–∏ MAVROS —Ç–æ–ø–∏–∫–∞–º–∏ –∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏, –ø–æ–∑–≤–æ–ª—è—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –ª–æ–≥–∏–∫–µ –º–∏—Å—Å–∏–π, –∞ –Ω–µ –Ω–∞ –¥–µ—Ç–∞–ª—è—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ MAVLink.

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ö—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä](#-–∫—Ä–∞—Ç–∫–∏–π-–æ–±–∑–æ—Ä)
- [–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#-–∫–ª—é—á–µ–≤—ã–µ-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–ú–µ—Ö–∞–Ω–∏–∑–º –º–∏—Å—Å–∏–π](#-–º–µ—Ö–∞–Ω–∏–∑–º-–º–∏—Å—Å–∏–π)
- [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#-api-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
  - [–ö–ª–∞—Å—Å Drone](#–∫–ª–∞—Å—Å-drone)
  - [–ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ](#–Ω–∞–≤–∏–≥–∞—Ü–∏—è-–∏-–ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ)
  - [–ü–æ–≤–æ—Ä–æ—Ç—ã (Yaw control)](#–ø–æ–≤–æ—Ä–æ—Ç—ã-yaw-control)
  - [–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã](#–∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã-–∏-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#-–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#-—Å–±–æ—Ä–∫–∞-–∏-–∑–∞–ø—É—Å–∫)
- [–ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è](#-–ø–ª–∞–Ω—ã-—Ä–∞–∑–≤–∏—Ç–∏—è)
- [–£—á–∞—Å—Ç–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ](#-—É—á–∞—Å—Ç–∏–µ-–≤-–ø—Ä–æ–µ–∫—Ç–µ)

---

## üéØ –ö—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä

Flight Control —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–Ω–æ–º–Ω—ã—Ö –ø–æ–ª—ë—Ç–Ω—ã—Ö –º–∏—Å—Å–∏–π –¥–ª—è –∫–≤–∞–¥—Ä–æ–∫–æ–ø—Ç–µ—Ä–æ–≤ –Ω–∞ –±–∞–∑–µ PX4. –í–º–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã —Å –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º–∏ MAVLink —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –∏ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤, –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ–π –∏ –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π Python API.

### –ß—Ç–æ —É–º–µ–µ—Ç –ø–∞–∫–µ—Ç:

```python
# –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –º–∏—Å—Å–∏–∏: –≤–∑–ª—ë—Ç ‚Üí –ø–æ–ª—ë—Ç –ø–æ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫—É ‚Üí –ø–æ—Å–∞–¥–∫–∞
class RectangleMission(Mission):
    def on_mission_start(self):
        self.drone.height = 10  # –ó–∞–¥–∞—ë–º –≤—ã—Å–æ—Ç—É 10 –º–µ—Ç—Ä–æ–≤
        self.drone.path = LineString([(0, 0), (20, 0), (20, 20), (0, 20), (0, 0)])
    
    def on_setpoint_callback(self):
        self.drone.update_navigation()
        if self.drone.at_end:
            self.drone.land_client.land(callback)
```

### –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è:

1. **–î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ—Å—Ç—å** ‚Äî –≤—ã –æ–ø–∏—Å—ã–≤–∞–µ—Ç–µ *—á—Ç–æ* –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å –¥—Ä–æ–Ω, –∞ –Ω–µ *–∫–∞–∫*
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** ‚Äî –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã —Å–µ—Ä–≤–∏—Å–æ–≤, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Å ROS 2 executor
4. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** ‚Äî –ª–µ–≥–∫–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–∏—Å—Å–∏–∏ –Ω–∞ –±–∞–∑–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞

---

## ‚ú® –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

| –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------------|----------|
| üõ´ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–∑–ª—ë—Ç** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ OFFBOARD —Ä–µ–∂–∏–º –∏ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ |
| üó∫Ô∏è **Path following** | –ü–æ–ª—ë—Ç –ø–æ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è–º (LineString) —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞–∑–±–∏–µ–Ω–∏–µ–º –Ω–∞ waypoints |
| üîÑ **Yaw control** | –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ –∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–≤–æ—Ä–æ—Ç—ã –≤ —Å–∏—Å—Ç–µ–º–∞—Ö NED/ENU |
| üìä **–¢–µ–ª–µ–º–µ—Ç—Ä–∏—è** | –î–æ—Å—Ç—É–ø –∫ –ø–æ–∑–∏—Ü–∏–∏, –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏, —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –≤—ã—Å–æ—Ç–µ |
| üìù **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** | –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª |
| ‚ö° **Async services** | –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–æ—Å–∞–¥–∫–∏, —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞ |

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
flight_control/
‚îú‚îÄ‚îÄ __init__.py                 # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞
‚îú‚îÄ‚îÄ main.py                     # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ ROS 2 –Ω–æ–¥—ã
‚îú‚îÄ‚îÄ drone.py                    # –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å Drone ‚Äî —è–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã
‚îú‚îÄ‚îÄ logger.py                   # –ö–∞—Å—Ç–æ–º–Ω—ã–π –ª–æ–≥–≥–µ—Ä —Å —Ü–≤–µ—Ç–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
‚îú‚îÄ‚îÄ mavros_sensors.py           # –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –Ω–∞ —Å–µ–Ω—Å–æ—Ä–Ω—ã–µ —Ç–æ–ø–∏–∫–∏ MAVROS
‚îú‚îÄ‚îÄ mavros_services.py          # –ö–ª–∏–µ–Ω—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤ MAVROS (arm, land, mode)
‚îú‚îÄ‚îÄ mavros_setpoints.py         # –ò–∑–¥–∞—Ç–µ–ª–∏ setpoint —Å–æ–æ–±—â–µ–Ω–∏–π
‚îî‚îÄ‚îÄ missions/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ missions.py             # –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å Mission
    ‚îî‚îÄ‚îÄ example.py              # –ü—Ä–∏–º–µ—Ä –º–∏—Å—Å–∏–∏
```

### –û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

#### `main.py` ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞

–ì–ª–∞–≤–Ω–∞—è ROS 2 –Ω–æ–¥–∞ `FlightControlNode`. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç `Drone`, –∑–∞–≥—Ä—É–∂–∞–µ—Ç –º–∏—Å—Å–∏—é –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –µ—ë —Å 5-—Å–µ–∫—É–Ω–¥–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π. –≠—Ç–∞ –Ω–æ–¥–∞ —è–≤–ª—è–µ—Ç—Å—è **–æ—Å–Ω–æ–≤–Ω–æ–π —É–ø—Ä–∞–≤–ª—è—é—â–µ–π –Ω–æ–¥–æ–π** –∏ –Ω–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç –Ω–∞–ª–∏—á–∏–µ –¥—Ä—É–≥–∏—Ö –Ω–æ–¥, —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö –¥—Ä–æ–Ω–æ–º –Ω–∞–ø—Ä—è–º—É—é.

```python
class FlightControlNode(Node):
    def __init__(self, drone_name: str = 'uav1'):
        super().__init__('flight_control')
        drone = Drone(drone_name=drone_name, node=self)
        self.mission = ExampleMission(drone=drone)
```

#### `drone.py` ‚Äî –ö–ª–∞—Å—Å Drone

–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å, –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É—é—â–∏–π –≤—Å—é –ª–æ–≥–∏–∫—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥—Ä–æ–Ω–æ–º:
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ–Ω—Å–æ—Ä–æ–≤, —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ setpoint –∏–∑–¥–∞—Ç–µ–ª–µ–π
- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –ø—É—Ç—è–º (LineString, Point)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã—Å–æ—Ç–æ–π –∏ —Å–∫–æ—Ä–æ—Å—Ç—å—é
- –ö–æ–Ω—Ç—Ä–æ–ª—å –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ (yaw)
- –°–≤–æ–π—Å—Ç–≤–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è (`at_height`, `at_end`, `stable`, `ready`)

#### `logger.py` ‚Äî –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–ö–∞—Å—Ç–æ–º–Ω—ã–π –ª–æ–≥–≥–µ—Ä `CustomDroneLogger`:
- –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å (ANSI –∫–æ–¥—ã)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª—ã (`logs/001_YYYYMMDD_HHMMSS.log`)
- –£—Ä–æ–≤–Ω–∏: DEBUG, INFO, WARNING, ERROR, CRITICAL

#### `mavros_sensors.py` ‚Äî –°–µ–Ω—Å–æ—Ä—ã

–ö–ª–∞—Å—Å—ã-–æ–±—ë—Ä—Ç–∫–∏ –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ MAVROS —Ç–æ–ø–∏–∫–∏:

| –ö–ª–∞—Å—Å | –¢–æ–ø–∏–∫ | –î–∞–Ω–Ω—ã–µ |
|-------|-------|--------|
| `InfoSensor` | `/mavros/local_position/pose` | –ü–æ–∑–∏—Ü–∏—è (x, y, z), –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è (quaternion), yaw/pitch/roll |
| `AltitudeSensor` | `/mavros/altitude` | –ú–æ–Ω–æ—Ç–æ–Ω–Ω–∞—è –∏ –ª–æ–∫–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ |
| `ImuSensor` | `/mavros/imu/data` | –î–∞–Ω–Ω—ã–µ IMU, –ª–∏–Ω–µ–π–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ |
| `VelocitySensor` | `/mavros/local_position/velocity_body` | –õ–∏–Ω–µ–π–Ω–∞—è –∏ —É–≥–ª–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å |

#### `mavros_services.py` ‚Äî –°–µ—Ä–≤–∏—Å—ã

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã MAVROS —Å–µ—Ä–≤–∏—Å–æ–≤:

| –ö–ª–∞—Å—Å | –°–µ—Ä–≤–∏—Å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|--------|------------|
| `ArmingClient` | `/mavros/cmd/arming` | –ê—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ / –¥–∏–∑–∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `LandClient` | `/mavros/cmd/land` | –ö–æ–º–∞–Ω–¥–∞ –Ω–∞ –ø–æ—Å–∞–¥–∫—É |
| `SetModeClient` | `/mavros/set_mode` | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ (OFFBOARD, LAND, RTL) |

#### `mavros_setpoints.py` ‚Äî Setpoints

–ò–∑–¥–∞—Ç–µ–ª–∏ —Ü–µ–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π:

| –ö–ª–∞—Å—Å | –¢–æ–ø–∏–∫ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|-------|------------|
| `PositionSetpoint` | `/mavros/setpoint_position/local` | –¶–µ–ª–µ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è (x, y, z) + yaw |
| `VelocitySetpoint` | `/mavros/setpoint_velocity/cmd_vel` | –¶–µ–ª–µ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (vx, vy, vz) + yaw_rate |

#### `missions/missions.py` ‚Äî –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –º–∏—Å—Å–∏–π

–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å `Mission`, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π:
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é OFFBOARD —Ä–µ–∂–∏–º–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ
- –¶–∏–∫–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ setpoints (20 Hz)
- –•—É–∫–∏ `on_mission_start()`, `on_setpoint_callback()`, `on_mission_end()`

#### `missions/example.py` ‚Äî –ü—Ä–∏–º–µ—Ä –º–∏—Å—Å–∏–∏

–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –º–∏—Å—Å–∏—è: –≤–∑–ª—ë—Ç ‚Üí –ø–æ–ª—ë—Ç –ø–æ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫—É ‚Üí –ø–æ—Å–∞–¥–∫–∞.

---

## üîÑ –ú–µ—Ö–∞–Ω–∏–∑–º –º–∏—Å—Å–∏–π

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –º–∏—Å—Å–∏–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         Mission.start()                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Step 1: –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö setpoints (1.5 —Å–µ–∫, 10 Hz)          ‚îÇ
‚îÇ  ‚Üí –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ OFFBOARD —Ä–µ–∂–∏–º                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Step 2: SetMode("OFFBOARD") ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤                ‚îÇ
‚îÇ  ‚Üí Callback: _set_mode_done_callback()                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Step 3: Arming(True) ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤                       ‚îÇ
‚îÇ  ‚Üí Callback: _arm_drone_done_callback()                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  on_mission_start() ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª: on_setpoint_callback() @ 20 Hz                   ‚îÇ
‚îÇ  ‚Üí –í—ã–∑–æ–≤ drone.update_navigation()                              ‚îÇ
‚îÇ  ‚Üí –õ–æ–≥–∏–∫–∞ –º–∏—Å—Å–∏–∏                                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Mission.stop() ‚Üí on_mission_end()                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –º–∏—Å—Å–∏–∏

```python
from enum import Enum
from shapely.geometry import LineString, Point
from flight_control.drone import Drone
from flight_control.missions.missions import Mission

class MissionState(Enum):
    TAKEOFF = 'takeoff'
    NAVIGATE = 'navigate'
    LAND = 'land'

class MyMission(Mission):
    TARGET_HEIGHT = 15  # –º–µ—Ç—Ä—ã
    
    def __init__(self, drone: Drone):
        super().__init__(name="My Custom Mission", drone=drone)
        self.state: MissionState = None
    
    def on_mission_start(self):
        """–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è."""
        self.drone.height = self.TARGET_HEIGHT
        self.state = MissionState.TAKEOFF
        self.logger.info("Mission started! Taking off...")
    
    def on_setpoint_callback(self):
        """–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 50 –º—Å (20 Hz). –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –º–∏—Å—Å–∏–∏."""
        # –í–ê–ñ–ù–û: –≤—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–π—Ç–µ update_navigation()!
        self.drone.update_navigation()
        
        match self.state:
            case MissionState.TAKEOFF:
                if self.drone.at_height:
                    self.logger.info("Reached target height!")
                    self.drone.path = LineString([(0, 0), (10, 10)])
                    self.state = MissionState.NAVIGATE
                    
            case MissionState.NAVIGATE:
                if self.drone.at_end:
                    self.logger.info("Reached destination!")
                    self.drone.height = 0
                    self.state = MissionState.LAND
                    
            case MissionState.LAND:
                if self.drone.at_height:
                    self.drone.land_client.land(self._on_land_complete)
    
    def on_mission_end(self):
        """–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –º–∏—Å—Å–∏–∏."""
        self.logger.info("Mission completed!")
    
    def _on_land_complete(self, future):
        """Callback –ø–æ—Å–∞–¥–∫–∏."""
        self.stop()
```

### –í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

1. **–í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–π—Ç–µ `drone.update_navigation()`** –≤ `on_setpoint_callback()` ‚Äî —ç—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç setpoints
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ state machine** ‚Äî —á—ë—Ç–∫–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –æ—à–∏–±–∫–∏
3. **–ù–µ –±–ª–æ–∫–∏—Ä—É–π—Ç–µ callback** ‚Äî –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ callbacks
4. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–≤–æ–π—Å—Ç–≤–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è** (`at_height`, `at_end`, `stable`) –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏

---

## üìö API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ö–ª–∞—Å—Å Drone

#### –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä

```python
Drone(drone_name: str, node: Node)
```

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `drone_name` | `str` | –ü—Ä–µ—Ñ–∏–∫—Å namespace –¥–ª—è MAVROS —Ç–æ–ø–∏–∫–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `'uav1'` ‚Üí `/uav1/mavros/...`) |
| `node` | `Node` | ROS 2 –Ω–æ–¥–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–æ–∫ –∏ –∏–∑–¥–∞—Ç–µ–ª–µ–π |

#### –°–≤–æ–π—Å—Ç–≤–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

| –°–≤–æ–π—Å—Ç–≤–æ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `ready` | `bool` | `True` –µ—Å–ª–∏ –ø–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ—Ç —Å–µ–Ω—Å–æ—Ä–æ–≤ |
| `at_height` | `bool` | `True` –µ—Å–ª–∏ –¥—Ä–æ–Ω –¥–æ—Å—Ç–∏–≥ —Ü–µ–ª–µ–≤–æ–π –≤—ã—Å–æ—Ç—ã (¬±`AT_HEIGHT_ERR`) |
| `at_end` | `bool` | `True` –µ—Å–ª–∏ –¥—Ä–æ–Ω –¥–æ—Å—Ç–∏–≥ –∫–æ–Ω—Ü–∞ –ø—É—Ç–∏ (–ø—Ä–æ–≥—Ä–µ—Å—Å >50%, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ <0.5–º) |
| `stable` | `bool` | `True` –µ—Å–ª–∏ pitch –∏ roll < `STABLE_ERROR_ANGLE` |
| `rotated` | `bool` | `True` –µ—Å–ª–∏ –ø–æ–≤–æ—Ä–æ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω (`target_yaw is None`) |
| `progress` | `float` | –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ç–µ–∫—É—â–µ–º—É –ø—É—Ç–∏ [0.0 - 1.0] |

#### –£–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã

| –ê—Ç—Ä–∏–±—É—Ç | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|--------------|----------|
| `height` | `float` | `0.0` | –¶–µ–ª–µ–≤–∞—è –≤—ã—Å–æ—Ç–∞ –≤ –º–µ—Ç—Ä–∞—Ö |
| `path` | `LineString \| Point \| None` | `None` | –¢–µ–∫—É—â–∏–π –ø—É—Ç—å –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ |
| `safe_speed` | `bool` | `False` | –†–µ–∂–∏–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–π (–º–µ–¥–ª–µ–Ω–Ω–æ–π) —Å–∫–æ—Ä–æ—Å—Ç–∏ |
| `hold_yaw` | `float \| None` | `None` | –£–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —É–≥–æ–ª yaw |
| `yaw_system` | `str` | `'NED'` | –°–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –¥–ª—è yaw (`'NED'` –∏–ª–∏ `'ENU'`) |

---

### –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ

#### `update_navigation()`

–û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏. **–î–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –≤ –∫–∞–∂–¥–æ–º —Ü–∏–∫–ª–µ `on_setpoint_callback()`.**

```python
def on_setpoint_callback(self):
    self.drone.update_navigation()  # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!
    # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è `height`
2. –ï—Å–ª–∏ –∑–∞–¥–∞–Ω `path`, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ü–µ–ª–µ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
3. –ï—Å–ª–∏ –∑–∞–¥–∞–Ω `target_yaw`, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ–≤–æ—Ä–æ—Ç–∞
4. –ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π setpoint (position –∏–ª–∏ velocity)

#### –ó–∞–¥–∞–Ω–∏–µ –ø—É—Ç–∏

```python
# –ü–æ–ª—ë—Ç –∫ —Ç–æ—á–∫–µ
drone.path = Point(10, 15)

# –ü–æ–ª—ë—Ç –ø–æ –ª–∏–Ω–∏–∏ (–æ—Ç —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–≤–∞—è —Ç–æ—á–∫–∞)
drone.path = LineString([(0, 0), (10, 0), (10, 10)])

# –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—É—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
drone.path = drone.build_path_to_point((50, 50))

# –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—É—Ç–∏ –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏
drone.path = drone.build_path_from_point_to_point((0, 0), (100, 100))
```

#### `build_path_to_point(position: tuple[float, float]) -> LineString`

–°—Ç—Ä–æ–∏—Ç –ø—É—Ç—å –æ—Ç —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ –¥—Ä–æ–Ω–∞ –¥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Ç–æ—á–∫–∏.

```python
# –ü–æ–ª—ë—Ç –∫ —Ç–æ—á–∫–µ (50, 30)
target = (50, 30)
drone.path = drone.build_path_to_point(target)
```

#### `build_path_from_point_to_point(start: tuple, end: tuple) -> LineString`

–°—Ç—Ä–æ–∏—Ç –ø—É—Ç—å –º–µ–∂–¥—É –¥–≤—É–º—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º–∏ —Ç–æ—á–∫–∞–º–∏.

```python
path = drone.build_path_from_point_to_point((0, 0), (100, 50))
drone.path = path
```

#### `get_angle_points(path: LineString, angle_threshold: float = 20.0) -> list[Point]`

–ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ —Ç–æ—á–∫–∏ –ø–æ–≤–æ—Ä–æ—Ç–∞ –∏–∑ –ø—É—Ç–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Å–ª–æ–∂–Ω—ã–º —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è–º.

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| `path` | `LineString` | ‚Äî | –ò—Å—Ö–æ–¥–Ω—ã–π –ø—É—Ç—å |
| `angle_threshold` | `float` | `20.0` | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É–≥–æ–ª –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ—á–∫–∏ |

---

### –ü–æ–≤–æ—Ä–æ—Ç—ã (Yaw control)

#### `abs_rotate_to(target_deg: float, system: str = 'NED')`

–ü–æ–≤–æ—Ä–æ—Ç –∫ –∞–±—Å–æ–ª—é—Ç–Ω–æ–º—É —É–≥–ª—É –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç.

```python
# –ü–æ–≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å–µ–≤–µ—Ä (0¬∞) –≤ —Å–∏—Å—Ç–µ–º–µ NED
drone.abs_rotate_to(0, system='NED')

# –ü–æ–≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≤–æ—Å—Ç–æ–∫ (90¬∞) –≤ —Å–∏—Å—Ç–µ–º–µ NED
drone.abs_rotate_to(90, system='NED')

# –ü–æ–≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —é–≥ (180¬∞)
drone.abs_rotate_to(180, system='NED')
```

**–°–∏—Å—Ç–µ–º—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:**
- **NED** (North-East-Down): 0¬∞ = –°–µ–≤–µ—Ä, 90¬∞ = –í–æ—Å—Ç–æ–∫, 180¬∞ = –Æ–≥, 270¬∞ = –ó–∞–ø–∞–¥
- **ENU** (East-North-Up): 0¬∞ = –í–æ—Å—Ç–æ–∫, 90¬∞ = –°–µ–≤–µ—Ä

#### `rotate_to(degree: float, system: str = 'NED')`

–û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–≤–æ—Ä–æ—Ç –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π —É–≥–æ–ª –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

```python
# –ü–æ–≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ 90¬∞ –≤–ø—Ä–∞–≤–æ (–ø–æ —á–∞—Å–æ–≤–æ–π)
drone.rotate_to(90)

# –ü–æ–≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ 45¬∞ –≤–ª–µ–≤–æ (–ø—Ä–æ—Ç–∏–≤ —á–∞—Å–æ–≤–æ–π)
drone.rotate_to(-45)

# –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ 180¬∞
drone.rotate_to(180)
```

#### –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ –ø–æ–≤–æ—Ä–æ—Ç–∞ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º

```python
def on_setpoint_callback(self):
    self.drone.update_navigation()
    
    match self.state:
        case State.ROTATING:
            if self.drone.rotated:  # –ü–æ–≤–æ—Ä–æ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω
                self.logger.info("Rotation complete!")
                self.state = State.NEXT_ACTION
```

---

### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

–ö–ª–∞—Å—Å `Drone` —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–±–æ—Ä –∫–æ–Ω—Å—Ç–∞–Ω—Ç, –≤–ª–∏—è—é—â–∏—Ö –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏. –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤ –ø–æ–¥–∫–ª–∞—Å—Å–µ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é.

#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏

| –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ï–¥–∏–Ω–∏—Ü—ã | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|---------|----------|
| `MAX_HORIZONTAL_SPEED` | `20.0` | –º/—Å | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å |
| `MAX_VERTICAL_SPEED` | `12.0` | –º/—Å | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å |
| `SAFE_HORIZONTAL_SPEED` | `0.25` | –º/—Å | –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º —Ä–µ–∂–∏–º–µ |
| `SAFE_VERTICAL_SPEED` | `0.55` | –º/—Å | –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º —Ä–µ–∂–∏–º–µ |

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞:**
```python
drone.safe_speed = True   # –í–∫–ª—é—á–∏—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º
drone.safe_speed = False  # –í–µ—Ä–Ω—É—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å
```

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã—Å–æ—Ç—ã

| –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|----------|
| `HEIGHT_ERROR_DIST` | `1.0` –º | –ó–æ–Ω–∞ –ø–ª–∞–≤–Ω–æ–≥–æ —Ç–æ—Ä–º–æ–∂–µ–Ω–∏—è –ø–æ –≤—ã—Å–æ—Ç–µ |
| `AT_HEIGHT_ERR` | `0.25` –º | –î–æ–ø—É—Å–∫ –¥–ª—è `at_height` (¬±25 —Å–º) |
| `EXTRA_HEIGHT_COEF` | `0.2` | –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –≤—ã—Å–æ—Ç—ã –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ |

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ï—Å–ª–∏ `|height_error| < 0.15` ‚Üí –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å = 0 (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö)
- –ï—Å–ª–∏ `|height_error| < HEIGHT_ERROR_DIST` ‚Üí –ª–∏–Ω–µ–π–Ω–æ–µ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ
- –ò–Ω–∞—á–µ ‚Üí –ø–æ–ª–Ω–∞—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–≤–æ—Ä–æ—Ç–∞ (Yaw)

| –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|----------|
| `SLOW_DOWN_YAW_ANGLE` | `45¬∞` | –£–≥–æ–ª –Ω–∞—á–∞–ª–∞ –∑–∞–º–µ–¥–ª–µ–Ω–∏—è –ø–æ–≤–æ—Ä–æ—Ç–∞ |
| `YAW_ERROR_DEG` | `15¬∞` | –î–æ–ø—É—Å–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–≤–æ—Ä–æ—Ç–∞ |

**–ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–≤–æ—Ä–æ—Ç–∞:**
1. –ï—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ —É–≥–ª–æ–≤ > 45¬∞ ‚Üí –ø–æ–ª–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ–≤–æ—Ä–æ—Ç–∞
2. –ï—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ < 45¬∞ ‚Üí –ª–∏–Ω–µ–π–Ω–æ–µ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç 0.85-1.0)
3. –ï—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ < 15¬∞ ‚Üí –ø–æ–≤–æ—Ä–æ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

| –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|----------|
| `STABLE_ERROR_ANGLE` | `5¬∞` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π pitch/roll –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è `stable` |
| `NEAR_DIST_GAP_ERROR` | `1.5` –º | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É waypoints |
| `PROGRESS_GAP_ERROR` | `0.25` | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —à–∞–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ |
| `SWITCH_SETPOINT_TYPE_PROGRESS` | `0.9` | –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∏–ø–∞ setpoint |
| `STRAIGHTNESS_THRESHOLD_ANGLE` | `35¬∞` | –ü–æ—Ä–æ–≥ —É–≥–ª–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä—è–º–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ |

#### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç

```python
# –°–ø–æ—Å–æ–± 1: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–µ
drone = Drone('uav1', node)
drone.MAX_HORIZONTAL_SPEED = 10.0  # –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å –¥–æ 10 –º/—Å

# –°–ø–æ—Å–æ–± 2: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª–∞—Å—Å–∞
class SlowDrone(Drone):
    MAX_HORIZONTAL_SPEED = 5.0
    MAX_VERTICAL_SPEED = 3.0
    SAFE_HORIZONTAL_SPEED = 0.1
```

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π –≤–∑–ª—ë—Ç –∏ –ø–æ—Å–∞–¥–∫–∞

```python
from enum import Enum
from flight_control.drone import Drone
from flight_control.missions.missions import Mission

class State(Enum):
    TAKEOFF = 'takeoff'
    HOVER = 'hover'
    LAND = 'land'

class HoverMission(Mission):
    def __init__(self, drone: Drone):
        super().__init__(name="Hover Mission", drone=drone)
        self.state = None
        self.hover_start_time = None
    
    def on_mission_start(self):
        self.drone.height = 5  # 5 –º–µ—Ç—Ä–æ–≤
        self.state = State.TAKEOFF
    
    def on_setpoint_callback(self):
        self.drone.update_navigation()
        
        match self.state:
            case State.TAKEOFF:
                if self.drone.at_height:
                    self.logger.info("Hovering for 10 seconds...")
                    self.hover_start_time = self.get_elapsed_time()
                    self.state = State.HOVER
                    
            case State.HOVER:
                if self.get_elapsed_time() - self.hover_start_time > 10:
                    self.logger.info("Starting landing...")
                    self.drone.set_mode_client.set_land_mode(lambda f: None)
                    self.state = State.LAND
                    
            case State.LAND:
                pass  # –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ—Å–∞–¥–∫–∏
    
    def on_mission_end(self):
        self.logger.info("Mission complete!")
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–ª—ë—Ç –ø–æ –º–∞—Ä—à—Ä—É—Ç—É —Å –ø–æ–≤–æ—Ä–æ—Ç–∞–º–∏

```python
from shapely.geometry import LineString, Point
from enum import Enum

class State(Enum):
    TAKEOFF = 'takeoff'
    ROTATE_NORTH = 'rotate_north'
    FLY_PATH = 'fly_path'
    RETURN = 'return'
    LAND = 'land'

class PatrolMission(Mission):
    PATROL_HEIGHT = 20
    PATROL_PATH = LineString([
        (0, 0), (50, 0), (50, 50), (0, 50), (0, 0)
    ])
    
    def __init__(self, drone: Drone):
        super().__init__(name="Patrol Mission", drone=drone)
        self.state = None
    
    def on_mission_start(self):
        self.drone.height = self.PATROL_HEIGHT
        self.state = State.TAKEOFF
    
    def on_setpoint_callback(self):
        self.drone.update_navigation()
        
        match self.state:
            case State.TAKEOFF:
                if self.drone.at_height and self.drone.stable:
                    self.logger.info("Rotating to North...")
                    self.drone.abs_rotate_to(0, system='NED')
                    self.state = State.ROTATE_NORTH
                    
            case State.ROTATE_NORTH:
                if self.drone.rotated:
                    self.logger.info("Starting patrol...")
                    self.drone.path = self.PATROL_PATH
                    self.state = State.FLY_PATH
                    
            case State.FLY_PATH:
                # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                if int(self.drone.progress * 100) % 25 == 0:
                    self.logger.info(f"Progress: {self.drone.progress:.0%}")
                
                if self.drone.at_end:
                    self.logger.info("Patrol complete! Landing...")
                    self.drone.set_mode_client.set_land_mode(lambda f: self.stop())
                    self.state = State.LAND
    
    def on_mission_end(self):
        self.logger.info("Patrol mission finished!")
```

### –ü—Ä–∏–º–µ—Ä 3: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –º–∞—Ä—à—Ä—É—Ç

```python
class DynamicMission(Mission):
    def __init__(self, drone: Drone, waypoints: list[tuple[float, float]]):
        super().__init__(name="Dynamic Mission", drone=drone)
        self.waypoints = waypoints
        self.current_wp = 0
        self.state = None
    
    def on_mission_start(self):
        self.drone.height = 10
        self.state = 'takeoff'
    
    def on_setpoint_callback(self):
        self.drone.update_navigation()
        
        if self.state == 'takeoff' and self.drone.at_height:
            self._go_to_next_waypoint()
            self.state = 'navigate'
        
        elif self.state == 'navigate' and self.drone.at_end:
            self.current_wp += 1
            if self.current_wp < len(self.waypoints):
                self._go_to_next_waypoint()
            else:
                self.logger.info("All waypoints visited!")
                self.drone.set_mode_client.set_land_mode(lambda f: self.stop())
                self.state = 'land'
    
    def _go_to_next_waypoint(self):
        wp = self.waypoints[self.current_wp]
        self.logger.info(f"Going to waypoint {self.current_wp + 1}: {wp}")
        self.drone.path = self.drone.build_path_to_point(wp)
    
    def on_mission_end(self):
        pass

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
# mission = DynamicMission(drone, [(10, 0), (10, 10), (0, 10), (0, 0)])
```

### –ü—Ä–∏–º–µ—Ä 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞

```python
class PrecisionMission(Mission):
    """–ú–∏—Å—Å–∏—è —Å —Ç–æ—á–Ω—ã–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –Ω–∞ –º–∞–ª–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏."""
    
    def on_mission_start(self):
        self.drone.height = 3
        self.drone.safe_speed = True  # –ú–µ–¥–ª–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
        self.state = 'takeoff'
    
    def on_setpoint_callback(self):
        self.drone.update_navigation()
        
        if self.state == 'takeoff' and self.drone.at_height:
            # –¢–æ—á–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–¥ —Ü–µ–ª—å—é
            self.drone.path = Point(5.0, 5.0)
            self.state = 'position'
        
        elif self.state == 'position' and self.drone.at_end:
            self.logger.info("Precise positioning achieved!")
            self.drone.safe_speed = False  # –í–µ—Ä–Ω—É—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å
            self.stop()
    
    def on_mission_end(self):
        pass
```

---

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Ubuntu 22.04** –∏–ª–∏ –Ω–æ–≤–µ–µ
- **ROS 2 Humble / Iron / Jazzy**
- **PX4 Autopilot** (SITL –∏–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä)
- **MAVROS 2.x**
- **Python 3.10+**

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python

```bash
pip3 install shapely
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ MAVROS

```bash
# –î–ª—è ROS 2 Humble
sudo apt install ros-humble-mavros ros-humble-mavros-extras

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ GeographicLib –¥–∞—Ç–∞—Å–µ—Ç–æ–≤
sudo /opt/ros/humble/lib/mavros/install_geographiclib_datasets.sh
```

### –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
cd ~/ros2_ws/src
git clone https://github.com/your-username/flight_control.git
```

---

## üöÄ –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –°–±–æ—Ä–∫–∞ –ø–∞–∫–µ—Ç–∞

```bash
cd ~/ros2_ws
colcon build --packages-select flight_control
source install/setup.bash
```

### –ó–∞–ø—É—Å–∫ —Å–∏–º—É–ª—è—Ü–∏–∏ PX4 (SITL)

–í –ø–µ—Ä–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ PX4 SITL:

```bash
cd ~/PX4-Autopilot
make px4_sitl gazebo-classic
```

### –ó–∞–ø—É—Å–∫ MAVROS

–í–æ –≤—Ç–æ—Ä–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```bash
ros2 launch mavros px4.launch fcu_url:="udp://:14540@localhost:14557"
```

### –ó–∞–ø—É—Å–∫ –Ω–æ–¥—ã Flight Control

–í —Ç—Ä–µ—Ç—å–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```bash
ros2 run flight_control main
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞

–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–º–µ–Ω–∏ –¥—Ä–æ–Ω–∞ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `main.py`:

```python
navigator = FlightControlNode(drone_name='uav1')
```

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ù–æ–¥–∞ `flight_control` —è–≤–ª—è–µ—Ç—Å—è **–≥–ª–∞–≤–Ω–æ–π —É–ø—Ä–∞–≤–ª—è—é—â–µ–π –Ω–æ–¥–æ–π**. –ù–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –¥—Ä—É–≥–∏—Ö –Ω–æ–¥, –Ω–∞–ø—Ä—è–º—É—é —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö –¥—Ä–æ–Ω–æ–º —á–µ—Ä–µ–∑ MAVROS setpoints. –ù–æ–¥—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–µ–Ω—Å–æ—Ä–æ–≤, –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è, –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ç.–¥. ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º—ã –∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø—É—Å–∫–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   PX4 SITL      ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ    MAVROS       ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ flight_control  ‚îÇ
‚îÇ   (–°–∏–º—É–ª—è—Ç–æ—Ä)   ‚îÇ     ‚îÇ  (ROS 2 Bridge) ‚îÇ     ‚îÇ  (–í–∞—à–∞ –º–∏—Å—Å–∏—è)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üó∫Ô∏è –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

### –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

- [ ] **MicroXRCEAgent** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä—è–º–æ–≥–æ DDS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å PX4 (–±–µ–∑ MAVROS)
- [ ] **Obstacle avoidance** ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–∞—Ç—á–∏–∫–∞–º–∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
- [ ] **Multi-drone** ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥—Ä–æ–Ω–æ–≤
- [ ] **Mission planner GUI** ‚Äî –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –º–∏—Å—Å–∏–π
- [ ] **Geofencing** ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–æ–Ω –ø–æ–ª—ë—Ç–∞
- [ ] **Failsafe handlers** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≤–∞—Ä–∏–π–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π

### –£–ª—É—á—à–µ–Ω–∏—è API

- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (lat/lon)
- [ ] Velocity-based path following
- [ ] Spline trajectories
- [ ] Camera gimbal control
- [ ] Payload drop support

---

## ü§ù –£—á–∞—Å—Ç–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ

> **–ü—Ä–æ–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!** –ú—ã –±—É–¥–µ–º —Ä–∞–¥—ã –ª—é–±–æ–º—É –≤–∫–ª–∞–¥—É –≤ —Ä–∞–∑–≤–∏—Ç–∏–µ –ø–∞–∫–µ—Ç–∞.

### –ö–∞–∫ –ø–æ–º–æ—á—å

1. **‚≠ê Star** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Äî —ç—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç—É —Å—Ç–∞—Ç—å –∑–∞–º–µ—Ç–Ω–µ–µ
2. **üêõ Issues** ‚Äî —Å–æ–æ–±—â–∞–π—Ç–µ –æ –±–∞–≥–∞—Ö –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–π—Ç–µ —É–ª—É—á—à–µ–Ω–∏—è
3. **üîÄ Pull Requests** ‚Äî –ø—Ä–∏—Å—ã–ª–∞–π—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
4. **üìñ Documentation** ‚Äî –ø–æ–º–æ–≥–∏—Ç–µ —É–ª—É—á—à–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ —Ñ–∞–π–ª–µ [LICENSE](LICENSE).

---

<div align="center">

**Made with ‚ù§Ô∏è for the ROS & PX4 community**

</div>